/*
 * Wallaby.js - v1.0.1328
 * https://wallabyjs.com
 * Copyright (c) 2014-2022 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
function getAbsoluteImportRoot(){var e=require("module"),t=new e(".",null),i=path.dirname(global.wallaby._localNodeModules);t.filename=path.join(i,"wallaby.js"),t.paths=e._nodeModulePaths(i);var r=e._resolveFilename("ava",t,!1);if(r.endsWith(path.sep+"ava"+path.sep+"entrypoints"+path.sep+"main.mjs")||r.endsWith(path.sep+"ava"+path.sep+"entrypoints"+path.sep+"main.cjs"))return r.substring(0,r.length-(path.sep+"ava"+path.sep+"entrypoints"+path.sep+"main.mjs").length)}function avaRequire(modulePath){return __awaiter(this,void 0,void 0,function(){var module,e_1;return __generator(this,function(_a){switch(_a.label){case 0:absoluteImportRoot&&(modulePath=path.join(absoluteImportRoot,modulePath)+".js"),_a.label=1;case 1:return _a.trys.push([1,2,,5]),module=require(modulePath),[3,5];case 2:return e_1=_a.sent(),"ERR_REQUIRE_ESM"!==e_1.code?[3,4]:[4,eval("import(modulePath)")];case 3:module=_a.sent(),module["default"]&&(Object.keys(module).forEach(function(e){module["default"][e]=module[e]}),module=module["default"]),_a.label=4;case 4:return[3,5];case 5:return[2,{path:modulePath,module:module}]}})})}var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,i,r){function n(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function o(e){try{l(r.next(e))}catch(t){s(t)}}function a(e){try{l(r["throw"](e))}catch(t){s(t)}}function l(e){e.done?i(e.value):n(e.value).then(o,a)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,s&&(o=2&i[0]?s["return"]:i[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(r){i=[6,r],s=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Q=require("q"),path=require("path"),tracer=global.$_$tracer,tracerUtils=tracer._utils,Runner,Test,runner,errorFormatter,format,improperUsage,onBeforeTest,onAfterTest,vm=require("vm"),url=require("url"),runtimeSupportsVmModules="function"==typeof vm.SyntheticModule;tracerUtils.patchModulesCode([{files:["ava/lib/snapshot-manager.js"],replacements:[{from:"function resolveSourceFile(file) {",to:"function resolveSourceFile(file) {\n          if (global.$_$testFiles) {\n            const metadata = global.$_$testFiles.find(m => m.path === file);\n            if (metadata && metadata.type && metadata.originalType && metadata.type !== metadata.originalType) {\t\t\t\n              return file.substring(0, file.length - metadata.type.length) + metadata.originalType;\n            }\n          }\n        "},{from:"const resolveSourceFile = mem(file => {",to:"const resolveSourceFile = mem(file => {\n          if (global.$_$testFiles) {\n            const metadata = global.$_$testFiles.find(m => m.path === file);\n            if (metadata && metadata.type && metadata.originalType && metadata.type !== metadata.originalType) {\t\t\t\n              return file.substring(0, file.length - metadata.type.length) + metadata.originalType;\n            }\n          }\n        "}]}]);try{var absoluteImportRoot=getAbsoluteImportRoot()}catch(e){}var testFiles=[],options={},initialized=!1,avaInstalled=!1,util=require("util"),truncate=function(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e},getMessage=function(e){return truncate(util.inspect(e.actual),128)+" "+e.operator+" "+truncate(util.inspect(e.expected),128)};tracer.start(function(){return __awaiter(this,void 0,void 0,function(){var nodeFs,originalRenameSync,Module,modulePrototype,originalRequire,originalLoad,changeTestMetadata,e_2,createChainReq,originalCreateChain,e_3,e_4,e_5,originalObjectDefineProperty,e_6,originalTestRun,e_7,sessionId,runComplete,otherSession,completeRun,isHook,specId,runnerPromise;return __generator(this,function(_a){switch(_a.label){case 0:if(initialized)return[3,23];_a.label=1;case 1:_a.trys.push([1,22,,23]),initialized=!0,nodeFs=require("fs"),originalRenameSync=nodeFs.renameSync,originalRenameSync.alreadyReplaced||(nodeFs.renameSync=function(e,t){var i=originalRenameSync.apply(this,arguments);if((".snap"===path.extname(t)||".md"===path.extname(t))&&0===t.indexOf(global.wallaby.projectCacheDir)){var r=require("fs-extra"),n=path.join(global.wallaby.localProjectDir,path.relative(global.wallaby.projectCacheDir,t));n&&(r.ensureDirSync(path.dirname(n)),nodeFs.writeFileSync(n,nodeFs.readFileSync(t)))}return i},nodeFs.renameSync.alreadyReplaced=!0),Module=require("module").Module,modulePrototype=Module.prototype,originalRequire=modulePrototype.require,originalLoad=Module._load,Module._load=function(e,t,i){if(~tracerUtils.normalizePath(e).indexOf("ava/lib/worker/main.cjs")){var r=runner.test||runner.chain.test||runner.chain;return r["default"]=r,r.test=r,r}return originalLoad.call(this,e,t,i)},modulePrototype.require=function(e){if("ava"===e){var t=runner.test||runner.chain.test||runner.chain;return t["default"]=t,t.test=t,t}if("empower-core"===e){var i=originalRequire.call(this,e),r=function(){var e=arguments[1].onError;return arguments[1].onError=function(t){return t.originalMessage=t.error.message+"\n",e.apply(this,arguments)},i.apply(this,arguments)};return r.defaultOptions=i.defaultOptions,r}return originalRequire.call(this,e)},changeTestMetadata=function(e){e.metadata.serial=!0,e.metadata._ignored="test"===e.metadata.type&&tracer.hasSpecFilter()&&!tracer.specFilter([e.title]),e.metadata._testFile=tracer.entryFile(),e.metadata._ignored&&(e.metadata.skipped=!0)},_a.label=2;case 2:return _a.trys.push([2,4,,5]),[4,avaRequire("ava/lib/worker/options")];case 3:return _a.sent().set({}).module,[3,5];case 4:return e_2=_a.sent(),[3,5];case 5:return _a.trys.push([5,7,,8]),[4,avaRequire("ava/lib/worker/create-chain-req")];case 6:return createChainReq=_a.sent(),originalCreateChain=createChainReq.module,require.cache[require.resolve(createChainReq.path)].exports=function(){var e=arguments[0];return arguments[0]=function(t,i){return changeTestMetadata({metadata:t,title:"string"==typeof i[0]?i[0]:void 0}),e.apply(this,arguments)},originalCreateChain.apply(this,arguments)},[3,8];case 7:return e_3=_a.sent(),[3,8];case 8:return _a.trys.push([8,10,,11]),[4,avaRequire("ava/lib/chalk")];case 9:return _a.sent().module.set({enabled:!1}).module,[3,11];case 10:return e_4=_a.sent(),[3,11];case 11:return _a.trys.push([11,13,,14]),[4,avaRequire("ava/lib/reporters/improper-usage-messages")];case 12:return improperUsage=_a.sent().module,[3,14];case 13:return e_5=_a.sent(),[3,14];case 14:return originalObjectDefineProperty=Object.defineProperty,Object.defineProperty=function(e,t,i){return"AssertionError"===t&&(i.writable=!0),originalObjectDefineProperty.apply(this,arguments)},[4,avaRequire("ava/lib/assert")];case 15:return _a.sent().module,[4,avaRequire("ava/lib/runner")];case 16:Runner=_a.sent().module,Object.defineProperty=originalObjectDefineProperty,_a.label=17;case 17:return _a.trys.push([17,19,,20]),[4,avaRequire("ava/lib/enhance-assert")];case 18:errorFormatter=_a.sent().module.formatter;try{errorFormatter()&&(errorFormatter=errorFormatter())}catch(e){}return[3,20];case 19:return e_6=_a.sent(),errorFormatter=null,[3,20];case 20:return[4,avaRequire("ava/lib/test")];case 21:return Test=_a.sent().module,originalTestRun=Test.prototype.run,Test.prototype.run=function(){onBeforeTest(this);try{tracer.specSyncStart();var e=originalTestRun.apply(this,arguments);return e.then&&e.then(function(e){return onAfterTest(e),e}),e}finally{tracer.specSyncEnd()}},avaInstalled=!0,[3,23];case 22:return e_7=_a.sent(),e_7&&e_7.stack&&tracer.reportGlobalError(e_7.stack),[3,23];case 23:return avaInstalled?(sessionId=global.$_$session,runComplete=!1,otherSession=function(){return sessionId!==global.$_$session},completeRun=function(){runComplete||otherSession()||(runComplete=!0,tracer.complete())},isHook=function(e){return"test"!==e.metadata.type},specId=tracer.initialSpecId(),tracer.started({total:"unknown number of"}),runnerPromise=Q.when(!0),testFiles.forEach(function(file){runnerPromise=runnerPromise.then(function(){return __awaiter(this,void 0,void 0,function(){var e_8,fileUrl,isExclusiveTestRun,ignoredTasks,_a,_b,task,_c,_d,task,ignoredTasks_1,ignoredTasks_1_1,task,onFulfilled,e_9,e_10,_e,e_11,_f,e_12,_g;return __generator(this,function(_h){switch(_h.label){case 0:return _h.trys.push([0,3,,4]),[4,avaRequire("ava/lib/globals")];case 1:return _h.sent().module.options={file:file},[4,avaRequire("ava/lib/snapshot-state")];case 2:return delete _h.sent().module.state,[3,4];case 3:return e_8=_h.sent(),[3,4];case 4:runner=new Runner(__assign(__assign({},options),{file:file,projectDir:global.wallaby.projectCacheDir,recordNewSnapshots:!0,updateSnapshots:tracer.canUpdateSnapshots()})),tracer.avaRunner=runner,onBeforeTest=function(e){otherSession()||isHook(e)||(e.metadata._id=++specId,tracer.specStart(e.metadata._id,e.title))},onAfterTest=function(e){if(!otherSession()){var t=e.passed;e=e.result?e.result:e;var i=isHook(e);if(!t||!i){var r=e.metadata.skipped||e.metadata.todo,n=tracer.specEnd(),s=e.metadata.skipped?"skipped":e.metadata.todo?"todo":"executed",o={id:e.metadata._id,timeRange:n,name:e.title,suite:[],status:s,time:void 0===e.duration?0:e.duration,log:[],hook:i?e.metadata.type:void 0,testFile:e.metadata&&e.metadata._testFile||void 0};if(!t&&!r){var a=e.assertError||e.error;if("Error thrown in test"===a.message&&delete a.message,a.powerAssertContext&&errorFormatter&&(a.message=errorFormatter(a.powerAssertContext)),improperUsage){var l=improperUsage.forError?improperUsage.forError(a):improperUsage(a);l&&(a.message=(a.message||"")+"\n"+l)}a.showDiff=!0;var c={message:a.message,stack:a.stack};/^\s+$/.test(c.message)?c.message=getMessage(a):!c.message&&format?c.message=format.formatSerializedError(a):a.values&&a.values.length&&(c.message=(c.message?c.message+"\n":"")+a.values[0].formatted),a.raw&&(a.actual=a.raw.actual,a.expected=a.raw.expected),tracer.setAssertionData(a,c),o.log.push(c)}o.log.length||delete o.log,tracer.result(o)}}},_h.label=5;case 5:return _h.trys.push([5,9,,10]),runtimeSupportsVmModules?(fileUrl=url.pathToFileURL(file),fileUrl.href=fileUrl.href+"?update="+ +new Date+"&wallaby=true",[4,eval("import(fileUrl)")]):[3,7];case 6:return _h.sent(),[3,8];case 7:require(file),_h.label=8;case 8:if(isExclusiveTestRun=!1,ignoredTasks=[],runner.tasks.serial)try{for(_a=__values(runner.tasks.serial),_b=_a.next();!_b.done;_b=_a.next())task=_b.value,!isExclusiveTestRun&&(isExclusiveTestRun=task.metadata.exclusive)||task.metadata.skipped&&ignoredTasks.push(task)}catch(e_10_1){e_10={error:e_10_1}}finally{try{_b&&!_b.done&&(_e=_a["return"])&&_e.call(_a)}finally{if(e_10)throw e_10.error}}if(isExclusiveTestRun)ignoredTasks=[];else if(runner.tasks.todo)try{for(_c=__values(runner.tasks.todo),_d=_c.next();!_d.done;_d=_c.next())task=_d.value,ignoredTasks.push(task)}catch(e_11_1){e_11={error:e_11_1}}finally{try{_d&&!_d.done&&(_f=_c["return"])&&_f.call(_c)}finally{if(e_11)throw e_11.error}}try{for(ignoredTasks_1=__values(ignoredTasks),ignoredTasks_1_1=ignoredTasks_1.next();!ignoredTasks_1_1.done;ignoredTasks_1_1=ignoredTasks_1.next())task=ignoredTasks_1_1.value,task.metadata._ignored||(onBeforeTest(task),onAfterTest(task))}catch(e_12_1){e_12={error:e_12_1}}finally{try{ignoredTasks_1_1&&!ignoredTasks_1_1.done&&(_g=ignoredTasks_1["return"])&&_g.call(ignoredTasks_1)}finally{if(e_12)throw e_12.error}}return onFulfilled=function(){runner.saveSnapshotState&&runner.saveSnapshotState()},[2,Q.promise(function(e){runner.on("error",function(e){throw e}),runner.on("start",function(t){return e(t.ended.then(onFulfilled))}),runner.on("finish",function(){return onFulfilled(),e()}),runner.start(),runner.start=function(){}})];case 9:return e_9=_h.sent(),tracer.reportDeclarationError(e_9),[2,Q.when(!0)];case 10:return[2]}})})})}),runnerPromise.then(completeRun),[2]):(tracer.reportGlobalError("ava node module is not found or the version is not supported, missing `npm install ava --save-dev`?"),[2])}})})}),module.exports={init:function(e){return testFiles=e,options}};